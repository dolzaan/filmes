<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Onde Assistir</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4">
  <h1 class="text-3xl font-bold mb-6 flex items-center gap-2">
    üîç Descubra onde assistir seu filme
  </h1>

  <div class="flex flex-col items-center w-full max-w-md">
    <input id="movieInput" type="text" placeholder="Digite o nome do filme"
      class="w-full p-3 rounded-lg text-black mb-4 outline-none" />
    <button id="searchBtn"
      class="bg-green-500 px-6 py-2 rounded-lg hover:bg-green-600 transition">
      Buscar
    </button>
  </div>

  <div id="results" class="mt-6 w-full max-w-5xl grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>

  <script>
    document.getElementById("searchBtn").addEventListener("click", async () => {
      const movie = document.getElementById("movieInput").value.trim();
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      if (!movie) {
        resultsDiv.innerHTML = "<p class='text-red-400'>Digite um nome v√°lido.</p>";
        return;
      }

      try {
        const res = await fetch(`http://localhost:3000/streaming/${encodeURIComponent(movie)}`);
        const data = await res.json();

        if (!data.filmes || data.filmes.length === 0) {
          resultsDiv.innerHTML = "<p class='text-gray-400'>Nenhum filme encontrado.</p>";
          return;
        }

        data.filmes.forEach(filme => {
          const filmeDiv = document.createElement("div");
          filmeDiv.className = "bg-gray-800 p-4 rounded-lg shadow-lg";

          let provedoresHTML = "";
          if (filme.provedores && filme.provedores.length > 0) {
            provedoresHTML = `
              <div class="flex gap-4 mt-3 flex-wrap">
                ${filme.provedores.map(p => `
                  <div class="flex flex-col items-center">
                    <img src="${p.logo}" alt="${p.nome}" class="w-12 h-12 mb-1 rounded">
                    <span class="text-sm">${p.nome}</span>
                  </div>
                `).join("")}
              </div>
            `;
          } else {
            provedoresHTML = `<p class="text-sm text-gray-400 mt-3">Nenhum provedor encontrado</p>`;
          }

          filmeDiv.innerHTML = `
  ${filme.capa ? `<img src="${filme.capa}" alt="${filme.titulo}" class="w-full rounded mb-3">` : ""}
  <h2 class="text-xl font-semibold">${filme.titulo}</h2>
  <p class="text-gray-300 mt-2">${filme.descricao || "Sem descri√ß√£o dispon√≠vel."}</p>
  ${provedoresHTML}
`;


          resultsDiv.appendChild(filmeDiv);
        });
      } catch (err) {
        console.error(err);
        resultsDiv.innerHTML = "<p class='text-red-400'>Erro ao buscar dados.</p>";
      }
    });
  </script>
</body>
</html>
